#------------------------------------------------------------------------------
#
#
#------------------------------------------------------------------------------
PACKAGE = Utilities

AAFBASE ?= ../..


# Common definitions
include $(AAFBASE)/build/common.mk


# Include directories
INCLUDES = -I../Include \
	   -I../../OMF/Include \
	   -I../../OMF/portinc \
	   -I../../ref-impl/include/ref-api \
	   -I../../ref-impl/include \
	   -I../../ref-impl/include/com-api


# CXXOBJS2 is the list of files used to create the executable.
CXXFILES2 = AafOmfMain.$(CPP_EXTENSION)


# LIBCXXOBJS is the list of object file used to create the library.
# It's generated by taking all the object files from current OBJDIR 
# and removing AafOmfMain.o from the list. 
LIBCXXOBJS = $(filter-out $(OBJDIR)/AafOmfMain$(OBJ), $(CXXOBJS))


LIBTARGET = $(LIBDIR)/libAAFConverterLib$(LIB)
BINTARGET = $(BINDIR)/AafOmf$(EXE)



.PHONY : all
all : $(LIBTARGET) $(BINTARGET)


# Build the library. Note that we use LIBCXXOBJS to not link
# files containing main() function.
$(LIBTARGET) : $(LIBDIR) $(OBJDIR) $(LIBCXXOBJS)
	$(LD_STAT_LIB) $@ $(LIBCXXOBJS)


# Build executable. Note that CXXOBJS2 is used instead of CXXOBJS.
$(BINTARGET) : $(BINDIR) $(OBJDIR) $(CXXOBJS2) $(LIBTARGET)
	$(LD) $(CXXOBJS2) $(RPATH_OPT) -lAAFConverterLib \
	-L$(AAFBASE)/OMF/IrixLibs -lAJPG -lOMFI -lbento -ljpeg \
	-L$(LIBDIR) -laaflib -laafiid -o $@ -lm


.PHONY : clean
clean :
	@$(RM) $(LIBCXXOBJS)
	@$(RM) $(CXXOBJS2)
	@$(RM) $(LIBTARGET)
	@$(RM) $(BINTARGET)
	@$(RMDIR) $(OBJDIR)/ii_files


.PHONY : realclean
realclean : clean


CFLAGS += -DNO_CONTAINER_EXPORTS


include $(AAFBASE)/build/rules.mk

