<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="MultiGenReadMe_files/filelist.xml">
<title>Title:</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="date"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>James Patrick Trainor</o:Author>
  <o:Template>Normal</o:Template>
  <o:LastAuthor>James Patrick Trainor</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>250</o:TotalTime>
  <o:Created>2002-03-26T01:25:00Z</o:Created>
  <o:LastSaved>2002-03-26T01:25:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>1001</o:Words>
  <o:Characters>5707</o:Characters>
  <o:Company> </o:Company>
  <o:Lines>47</o:Lines>
  <o:Paragraphs>13</o:Paragraphs>
  <o:CharactersWithSpaces>6695</o:CharactersWithSpaces>
  <o:Version>10.3131</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseFELayout/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:SimSun;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:\5B8B\4F53;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
@font-face
	{font-family:"\@SimSun";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 135135232 16 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:SimSun;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>Title:<span
style='mso-tab-count:1'>   </span>MultiGenTest<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Date:<span style='mso-tab-count:1'>    </span><st1:date
Month="3" Day="25" Year="2002">25 March 2002</st1:date></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Revision History:<span style='mso-tab-count:1'>           </span><st1:date
Year="2002" Day="25" Month="3">25 March 2002</st1:date>, Jim Trainor, Initial
version.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>MultiGenTest is a tool for testing
cross platform, and cross version, AAF compatibility.<span
style='mso-spacerun:yes'>  </span>It is comprised of three parts: i) a set of
test modules in the MultGenTests directory, ii) a test harness,
MultiGenTest.cpp, that is used to execute any set of individual test modules,
and iii) a Perl script, MultiGenTest.pl, that automates the execution of the
MultiGenTest program across a set of platforms, COM library versions, and
individual tests.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>MultiGenTest Program<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>Each test module in the
MultiGenTests module implements a simple test protocol (C++ virtual base
class).<span style='mso-spacerun:yes'>  </span>The test modules make their existence
known by registering a factory object with a registry.<span
style='mso-spacerun:yes'>  </span>The test module factories are static objects
that register themselves when they are constructed at program init time. </p>

<p class=MsoNormal style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>Each test takes it own set of
command line arguments.<span style='mso-spacerun:yes'>  </span>The MultiGenTest
program parses the command line and pulls out the command line arguments for
each <span class=GramE>tests</span>.<span style='mso-spacerun:yes'>  </span>It
then executes, in order, each <span class=GramE>tests</span> that were found on
the command line.<span style='mso-spacerun:yes'>  </span>A typical MultiGenTest
command line looks like this:</p>

<p class=MsoNormal style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'><span class=GramE>./</span>MultiGenTest
–r aTest anArg anArg –r anotherTest anArg anArg anArg …..</p>

<p class=MsoNormal style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>All <span class=SpellE>usefull</span>
processing is done by test modules.<span style='mso-spacerun:yes'>  </span>The
role of the code in <span class=SpellE>MultiGenTest.cpp</span> is simply to
execute test modules. Even loading the COM library is done within a test
module.</p>

<p class=MsoNormal style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>A small amount of state information
can be passes from one test to the next.<span style='mso-spacerun:yes'> 
</span>Currently the only state information is the currently open AAF
file.<span style='mso-spacerun:yes'>  </span>The “FileOp” test module will open
files, and save the resulting IAAFFile pointer in the state object.<span
style='mso-spacerun:yes'>  </span>Subsequent tests use this to access the open file.<span
style='mso-spacerun:yes'>  </span>Other state information can be added as required.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>There is a noop’ed test
implementation that is useful as a template to write new tests.</p>

<p class=MsoNormal style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>A typical MultiGenTest command is:</p>

<p class=MsoNormal style='text-indent:.5in'><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'><span class=GramE>./</span>MultiGenTest
–r LoadLib /my/aaf/path/libcom-api.so –FileOp write /tmp/test.aaf \</p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:.5in'>-<span
class=GramE>r</span> aTest anArg anArg anArg –r FileOp save_and_close –r
UnloadLib</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span
style='mso-tab-count:1'>           </span>If no arguments are passed to
MultiGenTest, it will dump the list of registered tests.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'>MultiGenTest Script<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span
style='mso-tab-count:1'>           </span>MultGenTest.pl is a <span
class=SpellE>Perl</span> script that will execute a set of tests across a set
of platforms and COM library versions.</p>

<p class=MsoNormal>It takes a single argument that is another Perl script that
is responsible for initializing numerous configuration parameters.<span
style='mso-spacerun:yes'>  </span>A sample configuration file is present in the
samples directory (samples/sample_cfg.pl). That sample file documents the
configuration parameters.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>The test
script implements a simple test procedure that executes every test on every
platform using every version of the COM library.<span
style='mso-spacerun:yes'>  </span>The result of each test (an .<span
class=SpellE>aaf</span> file) is then verified on each platform using each
version of the COM library.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>A test that
modifies a <span class=GramE>file,</span> will modify the result of a previous
test that created that file.<span style='mso-spacerun:yes'>   </span>The
original file is copied prior to each (per platform and version) modify
test.<span style='mso-spacerun:yes'>  </span>Modify tests operate on the copied
file, not the original. The result of each modify test is then verified on each
platform and version. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span><span
style='mso-tab-count:1'>           </span>The algorithm looks like this:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><span
class=GramE>foreach</span> test T {</p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span><span
class=SpellE><span class=GramE>foreach</span></span> platform Pc {</p>

<p class=MsoNormal><span style='mso-tab-count:3'>                                    </span><span
class=SpellE><span class=GramE>foreach</span></span> version <span
class=SpellE>Vc</span> {</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:4'>                                                </span><span
class=GramE>if</span> ( test creates a new file ) {</p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>//
<span class=GramE>We</span> need to test that we create the file on this
platform</p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>//
using this version.<span style='mso-spacerun:yes'>  </span>Then, we need to
verify that we can</p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>//
read the resulting file on every platform/version combo. </p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span><span
class=GramE>execute</span> test on Pc using <span class=SpellE>Vc</span></p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span><span
class=SpellE><span class=GramE>foreach</span></span> platform and version {</p>

<p class=MsoNormal><span style='mso-tab-count:6'>                                                                        </span><span
class=GramE>verify</span> contents of created file</p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>}</p>

<p class=MsoNormal><span style='mso-tab-count:4'>                                                </span>}</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:4'>                                                </span><span
class=GramE>else</span> if ( test modifies the result of a previous test ) {</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>//
<span class=GramE>We</span> need to test that every platform/version combo</p>

<p class=MsoNormal style='margin-left:2.0in;text-indent:.5in'>// can modify a
file created on any other platform/version</p>

<p class=MsoNormal style='margin-left:2.5in'>// combo.<span
style='mso-spacerun:yes'>  </span>This means that for *every* version of a test
file we</p>

<p class=MsoNormal style='margin-left:2.5in'>// created above, we must run the
modify test using *every*</p>

<p class=MsoNormal style='margin-left:2.5in'>// possible platform/version comb.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>//
<span class=GramE>We</span> also need to verify the every platform/version
combo</p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span>//
can read the modified file.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:5'>                                                            </span><span
class=GramE>foreach</span> platform Pm and version <span class=SpellE>Vm</span>
{</p>

<p class=MsoNormal><span style='mso-tab-count:6'>                                                                        </span><span
class=GramE>copy</span> result of test (<span class=SpellE>T,Pc,Vc</span>) to a
new file named (<span class=SpellE>T,Pm,Vm</span>)</p>

<p class=MsoNormal><span style='mso-tab-count:6'>                                                                        </span><span
class=GramE>modify</span> the new file</p>

<p class=MsoNormal><span style='mso-tab-count:6'>                                                                        </span><span
class=SpellE><span class=GramE>foreach</span></span> platform and version {</p>

<p class=MsoNormal><span style='mso-tab-count:7'>                                                                                    </span><span
class=GramE>verify</span> contents of modified file</p>

<p class=MsoNormal><span style='mso-tab-count:6'>                                                                        </span>}</p>

<p class=MsoNormal style='margin-left:2.0in;text-indent:.5in'>}</p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:.5in'>}</p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:.5in'><br>
} end foreach version</p>

<p class=MsoNormal><span style='mso-tab-count:2'>                        </span>}
end foreach platform</p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>} end
foreach test</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=SpellE>MultiGenTest</span> program is used
to create, modify, and verify files.<span style='mso-spacerun:yes'>  </span>The
exact commands to do that are stored in the configuration file.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>The <span class=SpellE>Perl</span>
script that implements this algorithm will execute MultGenTest this many times:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>Nct = num
create tests</p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>Nmt = num
modify tests</p>

<p class=MsoNormal style='text-indent:.5in'>Np = num platforms</p>

<p class=MsoNormal style='text-indent:.5in'><span class=GramE>Nv</span> = num
versions</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>Total
MultGenTest executions = (1 + NpNv<span class=GramE>)(</span> <span
class=SpellE>Nct</span> + <span class=SpellE>NmtNpNv</span>)<span class=SpellE>NpNv</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'> </span>The sample configuration
file (samples/sample_cfg.pl) has:<span style='mso-spacerun:yes'>  </span>Nct =
1, Nmt = 1, Np = 3, <span class=GramE>Nv</span> = 2.<span
style='mso-spacerun:yes'>  </span>This works out to</p>

<p class=MsoNormal>294 MultiGenTest executions (some are excluded – see note
bellows).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span>The output of
MultiGenTest.pl may be found in samples/sample_test_log.txt.gz.<span
style='mso-spacerun:yes'>  </span>Note<span class=GramE>,</span> there is an
additional test, not discussed here, that boosts the total number of
MultiGenTest executions to 300.<span style='mso-spacerun:yes'>  </span>This
count can be seen at the bottom of the log.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span>It takes about three
minutes to execute the tests in sample/sample_cfg.pl – not unreasonable.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span>The total number of
MultiGenTest executions varies <span class=GramE>O(</span>1) with Nct and Nmt,
hence, the total execution time will not grow unreasonably as more tests are
added.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span>However, the total
number of MultiGenTest executions varies <span class=GramE>O(</span>3) with Np
and Nv.<span style='mso-spacerun:yes'>  </span>Adding too many platforms or
versions could lead to unreasonable total execution times.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>   </span>With <span
class=SpellE>Nct</span> = <span class=SpellE>Nmt</span> = 8 (just a guess of a
typical test vector size), <span class=SpellE>Np</span> = 4 (Linux<span
class=GramE>,Mac,Irix,Win2K</span>), and <span class=SpellE>Nv</span> =4
(V1,V101,V15), 16224 executions would be required.<span
style='mso-spacerun:yes'>  </span>A rough time estimate is: 16224/294 * 3
minutes = 165 minutes.<span style='mso-spacerun:yes'>  </span>That is not too
bad considering how unusual it would be to run a test with such complete
platform and version coverage.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span>Some simple
optimizations could reduce that.<span style='mso-spacerun:yes'>  </span>For
example, caching the result of previous executions and only re-executing the
test vectors that failed (vector meaning the failed test and everything that
depended on it).<span style='mso-spacerun:yes'>  </span>That may be useful for
a developer requiring a fast test cycle.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-spacerun:yes'>  </span>One final minor
detail:<span style='mso-spacerun:yes'>  </span>some tests are known not to
work.<span style='mso-spacerun:yes'>  </span>For example, AAF COM library V1
cannot modify files.<span style='mso-spacerun:yes'>  </span>These are handled
using some ad-hoc test exclusion rules.<span style='mso-spacerun:yes'> 
</span>Excluded rules are counted as such and reported along with test that
passed and failed.<span style='mso-spacerun:yes'>  </span>The total number of
tests reported by MultiGenTest.pl should be constant regardless of the presence
of excluded tests.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>END <span style='display:none;mso-hide:all'>a: Trainor,
rsion</span></p>

</div>

</body>

</html>
