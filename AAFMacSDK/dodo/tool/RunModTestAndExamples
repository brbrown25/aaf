########################################################################
#
# The contents of this file are subject to the AAF SDK Public
# Source License Agreement (the "License"); You may not use this file
# except in compliance with the License.  The License is available in
# AAFSDKPSL.TXT, or you may obtain a copy of the License from the AAF
# Association or its successor.
#
# Software distributed under the License is distributed on an "AS IS"
# basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.  See
# the License for the specific language governing rights and limitations
# under the License.
#
# The Original Code of this file is Copyright 1998-2001, Licensor of the
# AAF Association.
#
# The Initial Developer of the Original Code of this file and the
# Licensor of the AAF Association is Avid Technology.
# All rights reserved.
#
########################################################################

#
# File: RunModTestAndExamples
#



set CHECK_DEBUG ""
set CHECK_RELEASE ""
set ESSENCETEST ""
set MODULETEST ""
#set TIMDUMP ""
set CLIENTTEST ""
set CUTSTEST ""
set PROPDIRECTDUMP ""
set PROPDIRECTACCESS ""
#set CREATESEQUENCE ""
#set ESSENCEACCESS ""
set AAFINFO ""
#set AAFOMFTEST ""
#set EXPORTAUDIOEXAMPLE ""
#set EXPORTSIMPLECOMPOSITION ""
#set IMPORTAUDIOEXAMPLE ""
set PERSONNELEXTENSIONTEST ""
#set PERSONNELEXTENSIONDIFF ""
set ALL ""
#set AAFWATCHDOG ""


alias PrintHelp 'echo "" ;¶
	echo "To run module test and all examples for specified target, use either:" ;¶
	echo " -r  = Release" ;¶
	echo " -d  = Debug" ;¶
	echo "" ;¶
	echo "To specify which tests to run, add any of the following:" ;¶
	echo " -a  = Run ALL Tests" ;¶
	echo " -ao = AafOmf" ;¶
	echo " -i  = ComAAFInfo" ;¶
	echo " -cl = ComClientTest" ;¶
	echo " -cu = ComCutsTest" ;¶
	echo " -e  = ComEssenceDataTest" ;¶
	echo " -m  = ComModAAF" ;¶
	echo " -pd = ComPropDirectDump" ;¶
	echo " -pa = ComPropDirectAccess" ;¶
	echo " -ea = EssenceAccess" ;¶
	echo " -cs = CreateSequence" ;¶
	echo " -pe = Personnel Extension tests" ;¶
	echo " -eae = ExportAudioExample" ;¶
	echo " -esc = ExportSimpleComposition" ;¶
	echo " -iae = ImportAudioExample" ;¶
	echo " -t  = dump\n\n" ;¶
	exit 1'

# There are required parameters!
if "{1}" == ""
	PrintHelp	
end if


# Process all of the arguments
loop
	if "{1}" == "-r"
		set CHECK_RELEASE "1"
	else if "{1}" == "-d"
		set CHECK_DEBUG "1"
	else if "{1}" == "-a"
		set ALL "1"
	else if "{1}" == "-i"
		set AAFINFO "1"
	else if "{1}" == "-cl"
		set CLIENTTEST "1"
	else if "{1}" == "-cu"
		set CUTSTEST "1"
	else if "{1}" == "-e"
		set ESSENCETEST "1"
	else if "{1}" == "-pd"
		set PROPDIRECTDUMP "1"
	else if "{1}" == "-pa"
		set PROPDIRECTACCESS "1"
	else if "{1}" == "-pe"
		set PERSONNELEXTENSIONTEST "1"
	else if "{1}" == "-m"
		set MODULETEST "1"
	else
	  echo 'Unsupported parameter:"'"{1}"'"'
		PrintHelp
	end if

	# continue processing parameters
	shift
	break if "{1}" == ""
end

if "{CHECK_RELEASE}{CHECK_DEBUG}" == ""
	PrintHelp	
end if


# cleanup local aliases
unalias PrintHelp

Set olddirectory `Directory`	# save the default directory
if "{CHECK_RELEASE}" ­ ""
	echo "Testing release build..."
	Directory "{aaf}AAFMacSDK:bin:"
else
	echo "Testing debug build..."
	Directory "{aaf}AAFMacSDK:bin:debug:"
end if


if "{AAFINFO}{ALL}" ­ ""
	if "" == "`exists -f Foo.aaf`"
		set CLIENTTEST "1"
	end if
end if

if "{CLIENTTEST}{ALL}" ­ ""
	echo "Running COMCLIENTAAF"
	ccommand COMCLIENTAAF
	echo ""
end if


if "{AAFINFO}{ALL}" ­ ""
	echo "Running COMAAFINFO"
	ccommand COMAAFINFO Foo.aaf
	echo ""
end if



if "{PROPDIRECTDUMP}{ALL}" ­ ""
	if "" == "`exists -f CutsOnly.aaf`"
		set CUTSTEST "1"
	end if
end if

if "{CUTSTEST}{ALL}" ­ ""
	echo "Running COMCUTSONLYTESTAAF"
	ccommand COMCUTSONLYTESTAAF
	echo ""
	echo ""
end if


if "{PROPDIRECTDUMP}{ALL}" ­ ""
	echo "Running COMPROPDIRECTDUMP"
	ccommand COMPROPDIRECTDUMP CutsOnly.aaf
	echo ""
	echo ""
end if

if "{ESSENCETEST}{ALL}" ­ ""
	echo "Running COMESSENCEDATATEST"
	ccommand COMESSENCEDATATEST
	echo ""
	echo ""
end if

#if "{PROPDIRECTACCESS}{ALL}" ­ ""
#	echo "Running COMPROPDIRECTACCESS"
#	ccommand COMPROPDIRECTACCESS
#	echo ""
#	echo ""
#end if

#if "{PERSONNELEXTENSIONTEST}{ALL}" ­ ""
#	echo "Running COMEXTENSIONWRITE"
#	ccommand "COMEXTENSIONWRITE"
#	echo ""
#	echo ""
#	echo "Running COMEXTENSIONREAD"
#	ccommand "COMEXTENSIONREAD"
#	echo ""
#	echo ""
#	echo "Running PERSONNELPLUGINWRITE"
#	ccommand "PERSONNELPLUGINWRITE"
#	echo ""
#	echo ""
#end if

if "{MODULETEST}{ALL}" ­ ""
	echo "Running COMMODAAF (PPC)"
	ccommand "COMMODAAF (PPC)"
	echo ""
	echo ""
end if

Directory "{olddirectory}"		# restore the original default directory
